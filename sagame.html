<!DOCTYPE html>
<html>
<head>

	<meta charset="UTF-8">
	<link type="text/css" rel="stylesheet" href="sagame.css" />
	<title> Freebike game </title>

    
    <link href="http://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet" type="text/css" />
    
	<script language="javascript" type="text/javascript" src="js/jquery-2.1.4.js"></script>
    <script type="text/javascript" src="js/Dexie.min.js"></script>
    <script language="javascript" type="text/javascript" src="js/FileSaver.js"></script>
    
    <script language="javascript" type="text/javascript" src="js/sagame_clips.js"></script>
    <script language="javascript" type="text/javascript" src="js/common.js"></script>
    <script language="javascript" type="text/javascript" src="js/markerlib.js"></script>
    
    <!-- offline: support for running without a server from file -->
    <script language="javascript" type="text/javascript" src="js/sagame_offline_clipsets.js"></script>
    <script language="javascript" type="text/javascript" src="js/sagame_offline_targets.js"></script>
    
    <script language="javascript" type="text/javascript" src="js/sagame.js"></script>
	<script language="javascript" type="text/javascript">
    
        var SAGAME_STYLE = 'yesno';
        SAGAME.showMarkers = 0;
        SAGAME.calibInterval = 999;

        var clipsets_json = 'js/sagame_clipsets_rsos2016.json';
        var targets_json = 'js/sagame_targets_rsos2016.json';        
        
        var search = window.location.search;
        if (search[0] == '?') { search = search.slice(1); } // Firefox can't handle leading ? 
        const params = new URLSearchParams(search);
        
        
        if (params.has('clipsets')) {
            console.log("clipsets got");
            clipsets_json = 'js/' + params.get("clipsets");
        }
        if (params.has('targets')) {
            targets_json = 'js/' + params.get("targets");
        }

		$(document).ready(function() {
            // offline fallback versions
            
            var req1 = loadClipsetsFrom(clipsets_json);
            req1.always( function() { // we go on always, because we trust on offline fallback
                var req2 = loadTargetsFrom(targets_json);
                req2.always( function() { // we go on always, because we trust on offline fallback
                    setupInteraction(); 
                });    
            });
        });
    
		//loadTargetsFrom('js/sagame_targets_20160125.json');
		//$(document).ready(function(){				
		//	setupInteraction();
        //});
        
    </script>

</head>

<body>

    <div id="login" class="instructions">
        
        <p>
        Player id <input id="playerId" type="text" value="" />
        </p>
        
        <p>
        <button id="loginButton">Aloita!</button>
        </p>

        <br />
        <br />
        <br />
        <p>
        <button id="downloadanswers">Download answers</button>
        <button id="downloadmarkers">Download markers</button>
        <button id="downloadevents">Download events</button>
        </p>

    </div>

    <div id="home" class="instructions">
        <p>
        <button id="showPracticeInstructions">Harjoittele</button>
        </p>

        <p>
        <button id="showGameInstructions">Pelaa</button>
        </p>

    </div>

    <div id="practiceInstructions" class="instructions">
        
        <p>Ohjeet peliin</p>
        <p>Pelissä näet videoita pyöräilijän näkökulmasta. Jossain vaiheessa video pysähtyy ja
        kuva katoaa näkyvistä. Harmaalle taustalle on piirretty ympyröitä.</p>
        
        <p>Valitse klikkaamalla ne ympyrät, joiden kohdalla oli joku toinen tienkäyttäjä tai näköeste, jonka 
        takaa joku voisi tulla eteesi.</p> 
        
        <p>Voit vaihtaa valintaasi klikkaamalla ympyrää uudestaan.</p>

        <p>Kun olet valmis, paina Tarkista, niin näet oikeat vastaukset.</p>
                
        
        <button id="startPractice">Harjoittele</button>
    
    </div>

    <div id="endInstructions" class="instructions">
        
        <p>Hienoa! Pelasit kaikki videot.</p>
    </div>


    <div id="gameInstructions" class="instructions">
        <p>Ohjeet peliin</p>
        <p>Pelissä näet videoita pyöräilijän näkökulmasta. Jossain vaiheessa video pysähtyy ja
        kuva katoaa näkyvistä. Harmaalle taustalle on piirretty ympyröitä.</p>
        
        <p>Valitse klikkaamalla ne ympyrät, joiden kohdalla oli joku toinen tienkäyttäjä tai näköeste, jonka 
        takaa joku voisi tulla eteesi.</p> 
        
        <p>Voit vaihtaa valintaasi klikkaamalla ympyrää uudestaan.</p>

        <p>Kun olet valmis, paina Tarkista, niin näet oikeat vastaukset.</p>
    
        <!-- <p>Seuraavaksi voidaan aloittaa itse peli!</p> -->
    <button id="startGame">Pelaa</button>
    
    </div>


    <div id="calibrationInstruction" class="instructions">        
        <p>Tässä välissä kalibroidaan silmänliikekamera</p>
	<p><br /><br /></p>
	<p><button id="calibrationInstructionContinue">Jatka</button></p>
    </div>

    <div id="currentvideo"></div>

    <div class="target" id="target_template"></div>	

    <div id="screen">
        <div id="points"><p>Pisteet 0</p></div>
        <video id="videoplayer" src="" muted></video> 
    </div>

    <div id="videoMask"></div>

    <button id="checkbutton">Tarkista</button> 
    <button id="nextbutton">Seuraava</button>
    
    
    <div class="query_feedback" id="query_feedback_template"></div>
	<div class="query_box" id="query_box_template"> 
		<!-- <div class="query_box_target">
		</div>
		<div class="query_box_buttons"</div>
			<div class="query_box_item pedestrian">J</div>
			<div class="query_box_item bicycle">P</div>
			<div class="query_box_item car">A</div>
			<div class="query_box_item occlusion">O</div>
			<div class="query_box_item nothing">Ei</div> 
		</div> -->
	</div>

    <audio id="targethitplayer" src="media/targethit.mp3"></audio>
    <audio id="missplayer" src="media/188039__antumdeluge__bicycle-horn.wav"></audio>
    
    <img id="marker1" src="media/marker1.png" />
    <img id="marker2" src="media/marker2.png" />
    <img id="marker3" src="media/marker3.png" />
    <img id="marker4" src="media/marker4.png" />
    
    
</body>
</html>
